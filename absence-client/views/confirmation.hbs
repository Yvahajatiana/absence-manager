<div class="page-header confirmation">
  <div class="hero-content">
    <h1 class="page-title">🔗 Confirmation de Déclaration</h1>
    <p class="page-subtitle">Détails de votre déclaration d'absence #{{absence.id}}</p>
  </div>
</div>

<div class="form-container">
  <div class="text-center" style="margin-bottom: 2rem;">
    <div style="display: inline-block; background: #e8f5e8; padding: 1rem 2rem; border-radius: 50px; margin-bottom: 1rem;">
      <span style="color: #28a745; font-size: 1.1rem; font-weight: 600;">
        ✅ Déclaration Active - #{{absence.id}}
      </span>
    </div>
  </div>

  <h2 class="section-title">📋 Informations de la déclaration</h2>

  <div class="info-sections">
    <div class="info-card">
      <h3>👤 Informations personnelles</h3>
      <div style="margin-bottom: 0.5rem;">
        <strong>Nom complet :</strong> {{absence.firstname}} {{absence.lastname}}
      </div>
      <div style="margin-bottom: 0.5rem;">
        <strong>Téléphone :</strong> {{absence.phone}}
      </div>
      {{#if absence.email}}
      <div style="margin-bottom: 0.5rem;">
        <strong>Email :</strong> {{absence.email}}
      </div>
      {{/if}}
      <div>
        <strong>Adresse :</strong> {{absence.adresseDomicile}}
      </div>
    </div>

    <div class="info-card">
      <h3>📅 Période d'absence</h3>
      <div style="margin-bottom: 0.5rem;">
        <strong>Date de début :</strong><br>
        {{formatDate absence.dateDebut}}
      </div>
      <div style="margin-bottom: 1rem;">
        <strong>Date de fin :</strong><br>
        {{formatDate absence.dateFin}}
      </div>
      <div class="alert alert-info" style="padding: 0.5rem; font-size: 0.9rem;">
        <strong>Durée :</strong> 
        <span data-duration>Calcul en cours...</span>
      </div>
    </div>
  </div>

  <div class="alert alert-success">
    <h3>🛡️ Statut de la surveillance</h3>
    <div>
      <div style="margin-bottom: 0.5rem;">
        <strong>✅ Déclaration enregistrée</strong> le {{formatDateTime absence.dateCreation}}
      </div>
      {{#unless (eq absence.dateModification absence.dateCreation)}}
      <div style="margin-bottom: 0.5rem;">
        <strong>📝 Dernière modification</strong> le {{formatDateTime absence.dateModification}}
      </div>
      {{/unless}}
      <div>
        <strong>🚔 Patrouilles programmées</strong> dans votre secteur pendant la période d'absence
      </div>
    </div>
  </div>

  <div class="info-sections">
    <div class="alert alert-warning">
      <h4>⏰ Période active</h4>
      <p style="margin: 0;">
        <span data-period-status>Calcul du statut en cours...</span>
      </p>
    </div>

    <div class="alert alert-success">
      <h4>📞 Contact d'urgence</h4>
      <p style="margin: 0;">
        En cas d'anomalie détectée, nous vous contacterons immédiatement au <strong>{{absence.phone}}</strong>
      </p>
    </div>
  </div>

  <div class="alert alert-danger">
    <h3>⚠️ Important : Modifications</h3>
    <p style="margin-bottom: 1rem;">
      Si vos plans changent (retour anticipé, prolongation, etc.), 
      <strong>contactez-nous immédiatement</strong> pour éviter tout malentendu.
    </p>
    <div class="text-center">
      <strong style="background: #721c24; color: white; padding: 0.5rem 1rem; border-radius: 4px;">
        📞 01 23 45 67 89 - Référence : #{{absence.id}}
      </strong>
    </div>
  </div>

  <div class="text-center" style="margin-top: 2rem;">
    <a href="/" class="btn btn-primary">← Retour à l'accueil</a>
    <button onclick="window.print()" class="btn btn-secondary">🖨️ Imprimer</button>
  </div>
</div>

<div class="contact-info">
  <h2 class="section-title">🏛️ Service de Police Municipale</h2>
  <div class="contact-grid">
    <div class="contact-item">
      <div class="contact-icon">📞</div>
      <strong>Urgence 24h/24</strong><br>
      <span style="color: #dc3545; font-weight: bold;">17</span>
    </div>
    
    <div class="contact-item">
      <div class="contact-icon">🏢</div>
      <strong>Standard</strong><br>
      01 23 45 67 89
    </div>
    
    <div class="contact-item">
      <div class="contact-icon">✉️</div>
      <strong>Email</strong><br>
      police.municipale@mairie.fr
    </div>
  </div>
</div>

<script>
  // Helper functions pour les calculs dynamiques
  document.addEventListener('DOMContentLoaded', function() {
    // Calculer la durée en jours
    const dateDebut = new Date('{{absence.dateDebut}}');
    const dateFin = new Date('{{absence.dateFin}}');
    const diffTime = Math.abs(dateFin - dateDebut);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    // Mettre à jour l'affichage de la durée
    const durationElement = document.querySelector('[data-duration]');
    if (durationElement) {
      durationElement.textContent = diffDays + ' jours';
    }
    
    // Déterminer le statut de la période
    const now = new Date();
    const statusElement = document.querySelector('[data-period-status]');
    if (statusElement) {
      let statusText = '';
      if (now < dateDebut) {
        statusText = `La surveillance débutera le ${dateDebut.toLocaleDateString('fr-FR')}`;
      } else if (now >= dateDebut && now <= dateFin) {
        statusText = `⚡ Surveillance en cours jusqu'au ${dateFin.toLocaleDateString('fr-FR')}`;
      } else {
        statusText = `Surveillance terminée le ${dateFin.toLocaleDateString('fr-FR')}`;
      }
      statusElement.textContent = statusText;
    }
  });
</script>